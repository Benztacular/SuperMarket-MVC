<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <title>Add Product</title>
  <style>
    html, body { height: 100%; }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: #f5f7fb;
    }
    main.add-product-page {
      flex: 1 0 auto;
      padding: 40px 0;
    }
    .edit-card { max-width: 920px; margin: 0 auto; }
    .preview-img {
      width: 170px;
      height: 170px;
      object-fit: contain;
      border: 1px solid #e9ecef;
      border-radius: 10px;
      background: #fff;
    }
    .form-label { font-weight: 600; }
    .muted-note { color:#6c757d; font-size:.9rem; }
    @media (max-width: 576px) {
      .preview-img { width: 100%; height: 220px; }
    }
  </style>
</head>
<body>
  <%- include('partials/header') %>

  <main class="add-product-page">
    <div class="container edit-card">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">Add Product</h4>
            <a href="/admin/inventory" class="btn btn-outline-secondary btn-sm">Back to Inventory</a>
          </div>

          <form action="/admin/products/add" method="post" enctype="multipart/form-data" class="row g-4">
            <div class="col-12 col-lg-8">
              <label class="form-label">Product name</label>
              <input name="productName" class="form-control" required>

              <label class="form-label mt-3">Price ($)</label>
              <input name="price" type="number" step="0.01" class="form-control" required>

              <div class="row">
                <div class="col-md-6">
                  <label class="form-label mt-3">Quantity</label>
                  <input name="quantity" type="number" class="form-control" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label mt-3">Category</label>
                  <select id="categorySelect" name="category" class="form-select">
                    <option value="">(no category)</option>
                  </select>
                  <div class="muted-note mt-1">Select an existing category.</div>
                </div>
              </div>

              <label class="form-label mt-3">Image</label>
              <div class="input-group">
                <input id="imageFile" name="image" type="file" accept="image/*" class="form-control">
                <button id="clearImageBtn" type="button" class="btn btn-outline-secondary">Clear</button>
              </div>
              <div class="muted-note mt-1">Allowed: jpg, png, gif.</div>

              <div class="mt-4 d-flex gap-2">
                <button type="submit" class="btn btn-primary">Save</button>
                <a href="/admin/inventory" class="btn btn-outline-secondary">Cancel</a>
              </div>
            </div>

            <div class="col-12 col-lg-4">
              <div class="text-center">
                <div class="mb-2 fw-semibold">Preview</div>
                <% const DEFAULT_IMG = 'https://static.vecteezy.com/system/resources/previews/018/765/757/original/user-profile-icon-in-flat-style-member-avatar-illustration-on-isolated-background-human-permission-sign-business-concept-vector.jpg'; %>
                <img id="preview" src="<%= DEFAULT_IMG %>" alt="image preview" class="preview-img mb-2" onerror="this.onerror=null;this.src='<%= DEFAULT_IMG %>'">
                <div class="muted-note">Currently creating: <strong id="previewName">New Product</strong></div>
                <div class="muted-note mt-2">
                  Selected category: <strong id="currentCategory">(none)</strong>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>

  <%- include('partials/footer') %>

  <script>
    (function () {
      const sel = document.getElementById('categorySelect');
      const currentCatEl = document.getElementById('currentCategory');
      const previewName = document.getElementById('previewName');
      const nameInput = document.querySelector('input[name="productName"]');

      fetch('/api/categories')
        .then(r => r.json())
        .then(list => {
          list.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c;
            opt.textContent = c;
            sel.appendChild(opt);
          });
        })
        .catch(() => {});
      sel.addEventListener('change', () => {
        currentCatEl.textContent = sel.value || '(none)';
      });

      nameInput.addEventListener('input', () => {
        previewName.textContent = nameInput.value.trim() || 'New Product';
      });

      const fileInput = document.getElementById('imageFile');
      const preview = document.getElementById('preview');
      const clearBtn = document.getElementById('clearImageBtn');
      const defaultImg = '<%= DEFAULT_IMG %>';

      fileInput.addEventListener('change', e => {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        preview.src = URL.createObjectURL(file);
      });

      clearBtn.addEventListener('click', () => {
        fileInput.value = '';
        preview.src = defaultImg;
      });
    })();
  </script>
</body>
</html>
