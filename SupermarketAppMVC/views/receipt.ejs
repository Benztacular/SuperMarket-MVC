<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Receipt - Order <%= orderId %></title>
  <!-- Bootstrap 5 (if needed by header/footer, though custom CSS handles the receipt) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-body: #f3f4f6;
      --paper: #ffffff;
      --ink: #1f2937;
      --muted: #6b7280;
      --accent: #0f9d58; /* FreshMart Green */
      --border-dashed: 2px dashed #e5e7eb;
    }

    html, body { height: 100%; margin: 0; }
    
    body {
      font-family: "Inter", sans-serif;
      background: var(--bg-body);
      color: var(--ink);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Main content grows */
    main { flex: 1 0 auto; padding: 40px 20px; display: flex; justify-content: center; align-items: flex-start; }

    /* --- RECEIPT STYLING --- */
    .receipt-container { width: 100%; display: flex; justify-content: center; }

    .receipt-card {
      max-width: 600px;
      width: 100%;
      background: var(--paper);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      padding: 40px;
      position: relative;
      border-top: 6px solid var(--accent); /* Brand Top Border */
      border-radius: 4px; /* Slight rounding like cardstock */
    }

    /* Success Icon */
    .success-icon {
      width: 64px;
      height: 64px;
      background: #dcfce7;
      color: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
    }

    /* Header Text */
    h1 {
      margin: 0 0 4px;
      font-size: 24px;
      font-weight: 700;
      color: var(--ink);
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .receipt-subtitle {
      text-align: center;
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 30px;
    }

    /* Meta Details (Monospace for numbers) */
    .meta-box {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }
    .meta-item { display: flex; flex-direction: column; gap: 4px; }
    .meta-label { font-size: 11px; text-transform: uppercase; color: var(--muted); font-weight: 600; letter-spacing: 0.5px; }
    .meta-value { font-family: 'JetBrains Mono', monospace; font-size: 14px; color: var(--ink); font-weight: 500; }

    /* Table Styling */
    .table-receipt { width: 100%; border-collapse: collapse; font-size: 14px; }
    
    .table-receipt th {
      text-align: left;
      padding: 12px 0;
      color: var(--muted);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      border-bottom: 2px solid #e5e7eb;
    }
    
    .table-receipt td {
      padding: 16px 0;
      border-bottom: 1px solid #f3f4f6;
      vertical-align: top;
    }

    /* Alignments */
    .right { text-align: right; }
    .center { text-align: center; }
    .price-col { font-family: 'JetBrains Mono', monospace; }

    /* Total Section */
    .table-receipt tfoot td {
      border-top: var(--border-dashed); /* Dashed line separator */
      border-bottom: none;
      padding-top: 20px;
      font-size: 16px;
    }
    .total-label { font-weight: 700; color: var(--ink); }
    .total-amount { 
      font-family: 'JetBrains Mono', monospace; 
      font-weight: 700; 
      font-size: 20px; 
      color: var(--accent); 
    }

    /* Actions */
    .actions {
      margin-top: 40px;
      display: flex;
      justify-content: center;
      gap: 16px;
      border-top: 1px solid #f3f4f6;
      padding-top: 24px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      border: none;
      cursor: pointer;
    }

    .btn-primary { background: var(--ink); color: #fff; }
    .btn-primary:hover { background: #000; transform: translateY(-1px); }

    .btn-secondary { background: #fff; border: 1px solid #d1d5db; color: var(--ink); }
    .btn-secondary:hover { background: #f9fafb; border-color: #9ca3af; }

    .btn-print { background: #fff; color: var(--accent); border: 1px dashed var(--accent); }
    .btn-print:hover { background: #f0fdf4; }

    /* Responsive */
    @media (max-width: 640px) {
      .receipt-card { padding: 24px; }
      .table-receipt th, .table-receipt td { font-size: 13px; }
      .actions { flex-direction: column; }
      .btn { width: 100%; justify-content: center; }
    }

    /* Print Styles */
    @media print {
      body { background: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      nav, footer, .actions { display: none !important; } /* Hide header/footer/buttons */
      main { padding: 0; }
      .receipt-card { box-shadow: none; border: 1px solid #ccc; max-width: 100%; padding: 0; margin: 0; }
      .success-icon { border: 2px solid #ddd; } /* Color bg might not print */
    }
  </style>
</head>
<body>
  
  <%- include('partials/header') %>

  <main>
    <div class="receipt-container">
      <div class="receipt-card">
        
        <!-- Success Icon -->
        <div class="success-icon">
          <i data-lucide="check" style="width:32px; height:32px;"></i>
        </div>

        <h1>Payment Successful</h1>
        <div class="receipt-subtitle">Thank you for your purchase at FreshMart</div>

        <div class="meta-box">
          <div class="meta-item">
            <span class="meta-label">Order ID</span>
            <span class="meta-value">#<%= orderId %></span>
          </div>
          <div class="meta-item right">
            <span class="meta-label">Date Placed</span>
            <span class="meta-value"><%= (createdAt ? (new Date(createdAt)).toLocaleString() : '-') %></span>
          </div>
        </div>

        <table class="table-receipt" aria-label="Order items">
          <thead>
            <tr>
              <th style="width: 50%;">Item Description</th>
              <th class="center" style="width: 15%;">Qty</th>
              <th class="right" style="width: 15%;">Price</th>
              <th class="right" style="width: 20%;">Total</th>
            </tr>
          </thead>
          <tbody>
            <% let computedTotal = 0; %>
            <% items.forEach(function(it){ 
                 const qty = Number(it.quantity || it.cartQty || 0);
                 const price = Number(it.price || 0);
                 const subtotal = qty * price;
                 computedTotal += subtotal;
            %>
            <tr>
              <td>
                <div style="font-weight: 500; color: #1f2937;"><%= it.productName || ('Product #' + (it.product_id||'—')) %></div>
                <div style="font-size: 12px; color: #9ca3af; margin-top: 2px;">SKU: <%= it.product_id || 'N/A' %></div>
              </td>
              <td class="center" style="color: #4b5563;">x<%= qty %></td>
              <td class="right price-col" style="color: #6b7280;">$<%= price.toFixed(2) %></td>
              <td class="right price-col" style="color: #1f2937; font-weight: 600;">$<%= subtotal.toFixed(2) %></td>
            </tr>
            <% }) %>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3" class="right total-label">Total Amount</td>
              <td class="right total-amount">$<%= (typeof totalAmount !== 'undefined' && totalAmount != null) ? Number(totalAmount).toFixed(2) : computedTotal.toFixed(2) %></td>
            </tr>
          </tfoot>
        </table>

        <div class="actions">
          <a class="btn btn-secondary" href="/shopping">
            <i data-lucide="arrow-left" style="width:16px;"></i> Continue Shopping
          </a>
          <a class="btn btn-secondary" href="/orders">
            <i data-lucide="package" style="width:16px;"></i> Order History
          </a>
          <button class="btn btn-print" onclick="window.print()">
            <i data-lucide="printer" style="width:16px;"></i> Print Receipt
          </button>
        </div>

      </div>
    </div>
  </main>

  <%- include('partials/footer') %>

  <!-- Initialize Icons -->
  <script>
    lucide.createIcons();
  </script>
</body>
</html>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Receipt - Order <%= orderId %></title>
  <!-- Bootstrap 5 (if needed by header/footer, though custom CSS handles the receipt) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-body: #f3f4f6;
      --paper: #ffffff;
      --ink: #1f2937;
      --muted: #6b7280;
      --accent: #0f9d58; /* FreshMart Green */
      --border-dashed: 2px dashed #e5e7eb;
    }

    html, body { height: 100%; margin: 0; }
    
    body {
      font-family: "Inter", sans-serif;
      background: var(--bg-body);
      color: var(--ink);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Main content grows */
    main { flex: 1 0 auto; padding: 40px 20px; display: flex; justify-content: center; align-items: flex-start; }

    /* --- RECEIPT STYLING --- */
    .receipt-container { width: 100%; display: flex; justify-content: center; }

    .receipt-card {
      max-width: 600px;
      width: 100%;
      background: var(--paper);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      padding: 40px;
      position: relative;
      border-top: 6px solid var(--accent); /* Brand Top Border */
      border-radius: 4px; /* Slight rounding like cardstock */
    }

    /* Success Icon */
    .success-icon {
      width: 64px;
      height: 64px;
      background: #dcfce7;
      color: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
    }

    /* Header Text */
    h1 {
      margin: 0 0 4px;
      font-size: 24px;
      font-weight: 700;
      color: var(--ink);
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .receipt-subtitle {
      text-align: center;
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 30px;
    }

    /* Meta Details (Monospace for numbers) */
    .meta-box {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }
    .meta-item { display: flex; flex-direction: column; gap: 4px; }
    .meta-label { font-size: 11px; text-transform: uppercase; color: var(--muted); font-weight: 600; letter-spacing: 0.5px; }
    .meta-value { font-family: 'JetBrains Mono', monospace; font-size: 14px; color: var(--ink); font-weight: 500; }

    /* Table Styling */
    .table-receipt { width: 100%; border-collapse: collapse; font-size: 14px; }
    
    .table-receipt th {
      text-align: left;
      padding: 12px 0;
      color: var(--muted);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      border-bottom: 2px solid #e5e7eb;
    }
    
    .table-receipt td {
      padding: 16px 0;
      border-bottom: 1px solid #f3f4f6;
      vertical-align: top;
    }

    /* Alignments */
    .right { text-align: right; }
    .center { text-align: center; }
    .price-col { font-family: 'JetBrains Mono', monospace; }

    /* Total Section */
    .table-receipt tfoot td {
      border-top: var(--border-dashed); /* Dashed line separator */
      border-bottom: none;
      padding-top: 20px;
      font-size: 16px;
    }
    .total-label { font-weight: 700; color: var(--ink); }
    .total-amount { 
      font-family: 'JetBrains Mono', monospace; 
      font-weight: 700; 
      font-size: 20px; 
      color: var(--accent); 
    }

    /* Actions */
    .actions {
      margin-top: 40px;
      display: flex;
      justify-content: center;
      gap: 16px;
      border-top: 1px solid #f3f4f6;
      padding-top: 24px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      border: none;
      cursor: pointer;
    }

    .btn-primary { background: var(--ink); color: #fff; }
    .btn-primary:hover { background: #000; transform: translateY(-1px); }

    .btn-secondary { background: #fff; border: 1px solid #d1d5db; color: var(--ink); }
    .btn-secondary:hover { background: #f9fafb; border-color: #9ca3af; }

    .btn-print { background: #fff; color: var(--accent); border: 1px dashed var(--accent); }
    .btn-print:hover { background: #f0fdf4; }

    /* Responsive */
    @media (max-width: 640px) {
      .receipt-card { padding: 24px; }
      .table-receipt th, .table-receipt td { font-size: 13px; }
      .actions { flex-direction: column; }
      .btn { width: 100%; justify-content: center; }
    }

    /* Print Styles */
    @media print {
      body { background: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      nav, footer, .actions { display: none !important; } /* Hide header/footer/buttons */
      main { padding: 0; }
      .receipt-card { box-shadow: none; border: 1px solid #ccc; max-width: 100%; padding: 0; margin: 0; }
      .success-icon { border: 2px solid #ddd; } /* Color bg might not print */
    }
  </style>
</head>
<body>
  
  <%- include('partials/header') %>

  <main>
    <div class="receipt-container">
      <div class="receipt-card">
        
        <!-- Success Icon -->
        <div class="success-icon">
          <i data-lucide="check" style="width:32px; height:32px;"></i>
        </div>

        <h1>Payment Successful</h1>
        <div class="receipt-subtitle">Thank you for your purchase at FreshMart</div>

        <div class="meta-box">
          <div class="meta-item">
            <span class="meta-label">Order ID</span>
            <span class="meta-value">#<%= orderId %></span>
          </div>
          <div class="meta-item right">
            <span class="meta-label">Date Placed</span>
            <span class="meta-value"><%= (createdAt ? (new Date(createdAt)).toLocaleString() : '-') %></span>
          </div>
        </div>

        <table class="table-receipt" aria-label="Order items">
          <thead>
            <tr>
              <th style="width: 50%;">Item Description</th>
              <th class="center" style="width: 15%;">Qty</th>
              <th class="right" style="width: 15%;">Price</th>
              <th class="right" style="width: 20%;">Total</th>
            </tr>
          </thead>
          <tbody>
            <% let computedTotal = 0; %>
            <% items.forEach(function(it){ 
                 const qty = Number(it.quantity || it.cartQty || 0);
                 const price = Number(it.price || 0);
                 const subtotal = qty * price;
                 computedTotal += subtotal;
            %>
            <tr>
              <td>
                <div style="font-weight: 500; color: #1f2937;"><%= it.productName || ('Product #' + (it.product_id||'—')) %></div>
                <div style="font-size: 12px; color: #9ca3af; margin-top: 2px;">SKU: <%= it.product_id || 'N/A' %></div>
              </td>
              <td class="center" style="color: #4b5563;">x<%= qty %></td>
              <td class="right price-col" style="color: #6b7280;">$<%= price.toFixed(2) %></td>
              <td class="right price-col" style="color: #1f2937; font-weight: 600;">$<%= subtotal.toFixed(2) %></td>
            </tr>
            <% }) %>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3" class="right total-label">Total Amount</td>
              <td class="right total-amount">$<%= (typeof totalAmount !== 'undefined' && totalAmount != null) ? Number(totalAmount).toFixed(2) : computedTotal.toFixed(2) %></td>
            </tr>
          </tfoot>
        </table>

        <div class="actions">
          <a class="btn btn-secondary" href="/shopping">
            <i data-lucide="arrow-left" style="width:16px;"></i> Continue Shopping
          </a>
          <a class="btn btn-secondary" href="/orders">
            <i data-lucide="package" style="width:16px;"></i> Order History
          </a>
          <button class="btn btn-print" onclick="window.print()">
            <i data-lucide="printer" style="width:16px;"></i> Print Receipt
          </button>
        </div>

      </div>
    </div>
  </main>

  <%- include('partials/footer') %>

  <!-- Initialize Icons -->
  <script>
    lucide.createIcons();
  </script>
</body>
</html>